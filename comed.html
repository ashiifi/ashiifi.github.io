<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ComEd Live Electricity Price</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #f5f5f5;
      color: #333;
      margin: 0;
    }

    h1 {
      margin-bottom: 10px;
    }

    #price {
      font-size: 2rem;
      margin: 10px 0;
    }

    #timestamp {
      font-size: 1rem;
      color: #777;
    }

    .cheap { color: green; }
    .normal { color: orange; }
    .expensive { color: red; }
  </style>
</head>
<body>
  <h1>âš¡ ComEd Real-Time Electricity Price</h1>
  <div id="price">Loading...</div>
  <div id="timestamp"></div>

  <script>
    async function fetchPrice() {
      try {
        const proxyUrl = 'https://corsproxy.io/?';
        const targetUrl = 'https://hourlypricing.comed.com/api?type=5minutefeed&format=json';
        const response = await fetch(proxyUrl + encodeURIComponent(targetUrl));
        const data = await response.json();
        const latest = data[data.length - 1];
        const priceCents = parseFloat(latest.price);
        const priceDollars = (priceCents / 100).toFixed(4);
        const millis = parseInt(latest.millisUTC);
        const timestamp = new Date(millis);

        const priceEl = document.getElementById('price');
        const tsEl = document.getElementById('timestamp');

        // Apply color class based on price threshold
        priceEl.className = '';
        if (priceCents < 3) {
          priceEl.classList.add('cheap');
        } else if (priceCents < 10) {
          priceEl.classList.add('normal');
        } else {
          priceEl.classList.add('expensive');
        }

        priceEl.textContent = `$${priceDollars} / kWh`;
        tsEl.textContent = `Last updated: ${timestamp.toLocaleString()}`;
      } catch (err) {
        console.error('Error fetching price:', err);
        document.getElementById('price').textContent = 'Error fetching data';
        document.getElementById('timestamp').textContent = '';
      }
    }

    fetchPrice();
    setInterval(fetchPrice, 5 * 60 * 1000); // every 5 minutes
  </script>
</body>
</html>
